<div class="header">
  <app-header></app-header>
</div>

<!-- Loading indicators are generally handled better with Bootstrap's utility classes or custom components, but for now, these are fine -->
<app-loading-modules *ngIf="isLoadingModules"></app-loading-modules>
<app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

<div class="main-container d-flex flex-column flex-lg-row"> <!-- Use flex utilities for layout -->

  <!-- Side Nav -->
  <div class="side-nav p-3 p-lg-4"> <!-- Add padding and responsive padding -->
    <app-side-nav></app-side-nav>
  </div>

  <!-- Main Content Area -->
  <div class="main-content flex-grow-1 d-flex flex-column"> <!-- Make main content grow and stack its children -->

    <!-- Toolbar -->
    <div class="toolbar my-toolbar p-3 mb-4 d-flex justify-content-between align-items-center flex-wrap">
      <div class="toolbar-title d-flex align-items-center">
        <fa-icon class="me-3 text-primary fs-2" [icon]="faBoxesStacked"></fa-icon> <!-- Use Bootstrap font size class -->
        <h1 class="h3 mb-0">DeltaV Assets</h1> <!-- Use Bootstrap heading and margin -->
      </div>
      <div class="toolbar-actions d-flex flex-wrap gap-2"> <!-- Use gap for spacing -->
        <!-- Download Button -->
        <button type="button" class="btn btn-success btn-lg me-2" (click)="exportToExcel()" [disabled]="isLoading">
          <fa-icon [icon]="faDownload"></fa-icon> Download <!-- Assuming you have faDownload -->
        </button>

        <!-- Upload Button (Label) -->
        <label for="fileInput" class="btn btn-dark btn-lg me-2 import-asset-button" [class.disabled]="isLoading">
          <fa-icon [icon]="faUpload"></fa-icon> Upload <!-- Assuming you have faUpload -->
        </label>
        <!-- Hidden File Input -->
        <input type="file" class="hidden-file-input" (change)="onFileChange($event)" id="fileInput" #fileInput accept=".xlsx, .xls" [disabled]="isLoading">

        <!-- Create Asset Button -->
        <button type="button" class="btn btn-primary btn-lg create-asset-button" (click)="openAddEditAssetsForm()" [disabled]="isLoading">
          <fa-icon [icon]="faPlus"></fa-icon> Create Asset <!-- Assuming you have faPlus -->
        </button>
      </div>
    </div>

    <!-- Filter Input -->
    <div class="mb-4">
      <!-- Added fa-icon for search -->
      <div class="d-flex align-items-center">
        <fa-icon class="me-2 text-muted" [icon]="faMagnifyingGlass"></fa-icon> <!-- Or faSearch -->
        <label for="filterInput" class="form-label fs-5 fw-bold mb-0">Search Assets</label> <!-- More descriptive label -->
      </div>
      <input type="text" class="form-control form-control-lg mt-2" id="filterInput" (keyup)="applyFilter($event)" placeholder="Filter by Asset Tag, Description, Serial Number, etc."> <!-- Larger input -->
    </div>

    <!-- Table Section -->
    <div class="table-responsive flex-grow-1"> <!-- Table will take available space -->
      <table class="table table-hover table-striped mb-0"> <!-- Removed table-bordered, Bootstrap's table-striped is often enough -->
        <thead class="table-primary"> <!-- Use Bootstrap's themed header -->
          <tr>
            <th scope="col" (click)="sortData('AssetTag')">Asset Tag <fa-icon [icon]="getSortIcon('AssetTag')"></fa-icon></th>
            <th scope="col" (click)="sortData('Description')">Description <fa-icon [icon]="getSortIcon('Description')"></fa-icon></th>
            <th scope="col" (click)="sortData('SerialNumber')">Serial Number <fa-icon [icon]="getSortIcon('SerialNumber')"></fa-icon></th>
            <th scope="col" (click)="sortData('CostCenter')">Cost Center <fa-icon [icon]="getSortIcon('CostCenter')"></fa-icon></th>
            <th scope="col" (click)="sortData('Warranty')">Warranty <fa-icon [icon]="getSortIcon('Warranty')"></fa-icon></th>
            <th scope="col" (click)="sortData('PoNumber')">PO Number <fa-icon [icon]="getSortIcon('PoNumber')"></fa-icon></th>
            <th scope="col" class="text-center">Action</th> <!-- Center action header -->
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of displayedData; let i = index" (click)="openAssetDetailsModal(row)" class="table-row-hover"> <!-- Added hover class -->
            <td>{{ row.AssetTag }}</td>
            <td>{{ row.Description }}</td>
            <td>{{ row.SerialNumber }}</td>
            <td>{{ row.CostCenter }}</td>
            <td>{{ row.Warranty | date:'shortDate' }}</td> <!-- Use Bootstrap's date pipe format -->
            <td>{{ row.PoNumber }}</td>
            <td class="action-buttons-cell text-center"> <!-- Center action buttons -->
              <button type="button" class="btn btn-outline-primary btn-sm me-1" (click)="openEditAssetsForm(row); $event.stopPropagation()">
                <fa-icon [icon]="faEdit"></fa-icon>
              </button>
              <button type="button" class="btn btn-outline-danger btn-sm" (click)="deleteAsset(row.id); $event.stopPropagation()">
                <fa-icon [icon]="faTrash"></fa-icon>
              </button>
            </td>
          </tr>
          <!-- Placeholder for empty table -->
          <tr *ngIf="displayedData.length === 0 && !isLoadingModules && !isLoading">
            <td colspan="7" class="text-center py-4">No IAMS Assets found.</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination Controls Section -->
    <div class="d-flex align-items-center justify-content-between mt-3 pagination-controls-wrapper flex-wrap gap-3">

      <!-- Items per page selector -->
      <div class="items-per-page-controls d-flex align-items-center gap-2">
        <label for="pageSizeSelect" class="form-label mb-0">Items per page:</label>
        <select class="form-select" [(ngModel)]="pageSize" (change)="onPageSizeChange()" id="pageSizeSelect" style="width: auto;"> <!-- Control width -->
          <option [ngValue]="5">5</option>
          <option [ngValue]="10">10</option>
          <option [ngValue]="25">25</option>
          <option [ngValue]="50">50</option> <!-- Added more options -->
          <option [ngValue]="100">100</option>
          <option [ngValue]="'all'">All</option>
        </select>
      </div>

      <!-- Pagination Navigation -->
      <nav aria-label="Page navigation" *ngIf="totalPages > 1 && pageSize !== 'all'">
        <ul class="pagination mb-0">
          <li class="page-item" [class.disabled]="page === 1">
            <a class="page-link" (click)="onPageChange(page - 1)" aria-label="Previous">
              <span aria-hidden="true">&laquo;</span>
            </a>
          </li>
          <!-- Changed here to call the new helper method -->
          <li class="page-item" *ngFor="let p of getPages()" [class.active]="p === page" [class.disabled]="p === '...'">
            <a class="page-link" (click)="handlePageLinkClick(p)">
              {{ p }}
            </a>
          </li>
          <li class="page-item" [class.disabled]="page === totalPages">
            <a class="page-link" (click)="onPageChange(page + 1)" aria-label="Next">
              <span aria-hidden="true">&raquo;</span>
            </a>
          </li>
        </ul>
      </nav>

      <!-- Showing X of Y results -->
      <div class="results-info" *ngIf="pageSize !== 'all'">
        Showing {{ (page - 1) * (pageSize || 1) + 1 }} - {{ (page - 1) * (pageSize || 1) + displayedData.length }} of {{ dataSource.length }} results
      </div>
      <div class="results-info" *ngIf="pageSize === 'all'">
        Showing {{ dataSource.length }} results
      </div>

    </div>

    <!-- Footer -->
    <div class="footer mt-4 p-3 text-center">
      <p class="mb-0 text-muted">(C)2025 - Developed by Manila Infrastructure Team</p>
    </div>

  </div>
</div>
