<div class="login-container">
  <mat-card class="login-card">

    <!-- Logo -->
    <div class="logo-container">
      <img src="assets/emerson3.png" alt="Emerson logo">
    </div>

    <!-- Title -->
    <div class="title-section">
      <h1>Infra Asset Management</h1>
    </div>

    <mat-card-content>
      <form [formGroup]="form" (ngSubmit)="login()">

        <!-- Username Input with Autocomplete -->
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Username</mat-label>
          <mat-icon matPrefix class="me-2 text-secondary">person</mat-icon>
          <input
            type="text"
            matInput
            formControlName="username"
            [matAutocomplete]="auto"
            placeholder="Ex. juan.delacruz"
          >
          <mat-autocomplete #auto="matAutocomplete">
            <mat-option *ngFor="let user of filteredUsernames | async" [value]="user">
              {{ user }}
            </mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="form.get('username')?.hasError('required')">
            Username is required
          </mat-error>
        </mat-form-field>

        <!-- Password Input with Visibility Toggle -->
        <mat-form-field appearance="outline" class="w-100">
          <mat-label>Password</mat-label>
          <mat-icon matPrefix class="me-2 text-secondary">lock</mat-icon>
          <input
            matInput
            [type]="hidePassword ? 'password' : 'text'"
            formControlName="password"
            placeholder="Enter your password"
          >
          <button
            mat-icon-button
            matSuffix
            type="button"
            (click)="hidePassword = !hidePassword"
            [attr.aria-label]="'Hide password'"
            [attr.aria-pressed]="hidePassword">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
          <mat-error *ngIf="form.get('password')?.hasError('required')">
            Password is required
          </mat-error>
        </mat-form-field>

        <!-- Forgot Password Link -->
        <div class="forgot-pass">
          <a href="javascript:void(0)" (click)="openResetModal(resetModal)">
            Forgot Password?
          </a>
        </div>

        <!-- Login Button -->
        <button
          mat-flat-button
          color="primary"
          type="submit"
          class="w-100 login-btn"
          [disabled]="form.invalid || loading">
          {{ loading ? 'Logging in...' : 'Login' }}
        </button>

      </form>
    </mat-card-content>
  </mat-card>
</div>

<!-- NgbModal Template (Kept functional logic, just cleaned up UI) -->
<ng-template #resetModal let-modal>
  <div class="modal-header border-0 pb-0">
    <h4 class="modal-title fw-bold text-primary">Reset Password</h4>
    <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <p class="text-muted small mb-4">Enter your username. We will send a password reset link to your registered email address.</p>

    <div class="mb-2">
      <label for="resetUsername" class="form-label fw-bold">Username</label>
      <input
        type="text"
        class="form-control form-control-lg bg-light"
        id="resetUsername"
        [(ngModel)]="resetUsernameStr"
        placeholder="Enter username"
        (keydown.enter)="confirmReset(modal)">
    </div>
  </div>
  <div class="modal-footer border-0 pt-0">
    <button type="button" class="btn btn-light text-secondary" (click)="modal.dismiss('cancel')">Cancel</button>
    <button type="button" class="btn btn-primary px-4" (click)="confirmReset(modal)">Send Reset Link</button>
  </div>
</ng-template>
